@page "{budgetid}/{year}/{month}"
@model DrCost.Pages.Budget.DetailModel
@{
}

<style>
    .days_wrapper {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
    }

    .day_day {
        border: 1px solid #c1c1c1;
        text-align: center;
    }

    .day0 {
        grid-column: 7 / 8;
        border: 2px solid #c1c1c1;
    }

    .day1 {
        grid-column: 1 / 2;
        border: 2px solid #c1c1c1;
    }

    .day2 {
        grid-column: 2 / 3;
        border: 2px solid #c1c1c1;
    }

    .day3 {
        grid-column: 3 / 4;
        border: 2px solid #c1c1c1;
    }

    .day4 {
        grid-column: 4 / 5;
        border: 2px solid #c1c1c1;
    }

    .day5 {
        grid-column: 5 / 6;
        border: 2px solid #c1c1c1;
    }

    .day6 {
        grid-column: 6 / 7;
        border: 2px solid #c1c1c1;
    }

    .today {
        border: 3px solid #009cff;
        /*background-color: #dff2ff;*/
    }

    .minitip {
        font-size: 12px;
        text-align: right;
        margin-right: 5px;
    }

    .day_wrapper {
        display: grid;
        grid-template-columns: 20% 80%;
        grid-template-rows: 50% 50%;
    }

    .day_button {
        grid-column: 1;
        grid-row: 1 / 3;
    }

    .day_button-empty {
        grid-column: 1;
        grid-row: 1 / 3;
        border: 1px solid #000;
        text-align: center;
    }

    .day_given {
        grid-column: 2;
        grid-row: 1;
        color: #21610B;
    }

    .day_spent {
        grid-column: 2;
        grid-row: 2;
        color: #FF0040;
    }

    .spentOk {
        background-color: #F1F8E0;
    }

    .spentViolated {
        background-color: #FBEFEF;
    }

</style>

<p>
    <a class="btn btn-link" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
        Настройки
    </a>
</p>
<div class="collapse" id="collapseExample">
    <a class="btn btn-link" asp-page="/budget/edit" asp-route-budgetid="@Model.BudgetInst.BudgetId">Настройка бюджета</a>
    <a class="btn btn-link">Этот месяц</a>
</div>
<br />

Бюджет: "@Model.BudgetInst.BudgetName"
<br />
@Model.BudgetInst.Month, @Model.BudgetInst.Year год

@{
    int month = DateTime.Today.Month;
    int year = DateTime.Today.Year;
    int budgetid = Model.BudgetInst.BudgetId;
    var months = new List<SelectListItem>
    {
        new SelectListItem{ Value = "1", Text = "Январь" },
        new SelectListItem{ Value = "2", Text = "Февраль" },
        new SelectListItem{ Value = "3", Text = "Март" },
        new SelectListItem{ Value = "4", Text = "Апрель" },
        new SelectListItem{ Value = "5", Text = "Май" },
        new SelectListItem{ Value = "6", Text = "Июнь" },
        new SelectListItem{ Value = "7", Text = "Июль" },
        new SelectListItem{ Value = "8", Text = "Август" },
        new SelectListItem{ Value = "9", Text = "Сентябрь" },
        new SelectListItem{ Value = "10", Text = "Октябрь" },
        new SelectListItem{ Value = "11", Text = "Ноябрь" },
        new SelectListItem{ Value = "12", Text = "Декабрь" }
    };
    var years = Enumerable.Range(2021, 10).Select(x => new SelectListItem { Value = x.ToString(), Text = x.ToString() });
}

<form method="post">
    <input type="hidden" asp-for="@budgetid"/>

    <span>
        <label for="year">Year:</label>
        <select asp-for="@year" asp-items="@years" onchange="this.form.submit()">
        </select>
    </span>
    <span>
        <label for="month">Month:</label>
        <select asp-for="@month" asp-items="@months" onchange="this.form.submit()">
        </select>
    </span>

</form>

<br />
Выделено: @Model.BudgetInst.AllotedSum RUB
<br />
Общие расходы: @Model.MonthSpent RUB
<br />

<hr />

@if (Model.BudgetInst.HasCalendar)
{
    <div class="days_wrapper">

        <div class="day_day">Понедельник</div>
        <div class="day_day">Вторник</div>
        <div class="day_day">Среда</div>
        <div class="day_day">Четверг</div>
        <div class="day_day">Пятница</div>
        <div class="day_day">Суббота</div>
        <div class="day_day">Воскресенье</div>

        @foreach (var item in Model.Calendar)
        {
            if (item.isPastOrPresent)
            {
                if (item.isToday)
                {
                    <div class="day@((uint)item.Date.DayOfWeek) today @(item.Spent <= item.Allowed ? "spentOk" : "spentViolated")">
                        <div class="day_wrapper">
                            <a asp-page="/budget/spending" asp-route-budgetId="@Model.BudgetInst.BudgetId" asp-route-date="@item.Date.ToShortDateString()" class="button button-green day_button">@item.Date.Day</a>
                            <div class="minitip day_given">@(item.Allowed.ToString("0.00"))</div>
                            <div class="minitip day_spent">- @(item.Spent.ToString("0.00"))</div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="day@((uint)item.Date.DayOfWeek) @(item.Spent <= item.Allowed ? "spentOk" : "spentViolated")">
                        <div class="day_wrapper">
                            <a asp-page="/budget/spending" asp-route-budgetId="@Model.BudgetInst.BudgetId" asp-route-date="@item.Date.ToShortDateString()" class="button button-green day_button">@item.Date.Day</a>
                            <div class="minitip day_given">@(item.Allowed.ToString("0.00"))</div>
                            <div class="minitip day_spent">- @(item.Spent.ToString("0.00"))</div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="day@((uint)item.Date.DayOfWeek)">
                    <div class="day_wrapper">
                        @*<a asp-page="/budget/days/oneday" class="button button-green day_button">@item.Day</a>*@
                        <div class="day_button-empty">@item.Date.Day</div>
                        <div class="minitip day_given">@(item.Allowed.ToString("0.00"))</div>
                        <div class="minitip day_spent">-</div>
                    </div>
                </div>
            }
        }
    </div>
}